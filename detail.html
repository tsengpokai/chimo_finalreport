<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>詳細內容</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <canvas id="geo-canvas"></canvas>

    <div class="detail-container">
        <br>
        <a href="index.html" style="color:var(--accent-cyan); text-decoration:none; font-size:1.1rem; font-weight:bold;">
            <i class="fas fa-arrow-left"></i> 返回時間軸
        </a>
        
        <div id="content-wrapper" style="background: rgba(13, 22, 35, 0.9); border: 1px solid var(--accent-cyan); padding: 40px; border-radius: 16px; margin-top: 20px;">
            </div>
    </div>

    <script src="data.js"></script>
    <script src="script.js"></script>
    <script>
        // Detail Page Logic
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        const data = courseData[id];
        const wrapper = document.getElementById('content-wrapper');

        if(data) {
            let html = `
                <div style="border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 30px;">
                    <div style="color: var(--accent-cyan); font-family: 'Orbitron'; margin-bottom: 10px;">${data.date}</div>
                    <h1 style="font-size: 2.5rem; margin-bottom: 15px; color:white;">${data.title}</h1>
                    <div>${data.tags.map(t => `<span style="background:rgba(0,242,255,0.1); color:var(--accent-cyan); padding:4px 8px; margin-right:5px; border-radius:4px; font-size:0.8rem;">#${t}</span>`).join('')}</div>
                </div>
            `;

            data.content.forEach(item => {
                if(item.type === 'text') {
                    html += `<div style="margin-bottom:25px;"><h3 style="color:var(--accent-blue); margin-bottom:10px;">${item.heading || ''}</h3><p style="color:#ddd; line-height:1.8;">${item.body}</p></div>`;
                } else if (item.type === 'image') {
                     // 圖片占位符處理
                     html += `
                        <div style="text-align:center; margin: 20px 0; border: 1px dashed #555; padding: 20px;">
                            ${item.src.includes('http') || item.src.includes('.jpg') ? 
                                `<img src="${item.src}" alt="${item.caption}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                                 <div style="display:none; color:orange;">[圖片] 請將 ${item.src} 放入資料夾</div>` 
                                : ``
                            }
                            <p style="color:#aaa; font-size:0.9rem; margin-top:5px;">${item.caption}</p>
                        </div>`;
                } else if (item.type === 'math') {
                    html += `<div style="background:rgba(0,0,0,0.3); padding:15px; border-left:3px solid var(--accent-cyan); margin:15px 0;"><strong>${item.heading}</strong><div style="margin-top:10px;">${item.body}</div></div>`;
                } else if (item.type === 'iframe') {
                    html += `<div style="margin:30px 0;"><iframe src="${item.src}" width="100%" height="500" style="border:none; border-radius:8px; background:#000;"></iframe><p style="text-align:center; color:#aaa; margin-top:5px;">${item.caption}</p></div>`;
                } else if (item.type === 'link_group') {
                    html += `<div style="margin-top:20px;">${item.links.map(l=>`<a href="${l.url}" target="_blank" style="background:var(--accent-blue); color:white; padding:10px 20px; text-decoration:none; border-radius:5px; margin-right:10px;">${l.text}</a>`).join('')}</div>`;
                }
                
                // --- 遊戲 1: 磁條帶模擬器 ---
                else if (item.type === 'game_magnetic') {
                    html += `
                        <div class="game-box">
                            <h2 style="color:var(--accent-cyan); text-align:center;"><i class="fas fa-magnet"></i> ${item.heading}</h2>
                            <p style="color:#ccc; text-align:center; margin-bottom:15px;">${item.caption}</p>
                            <label style="color:#aaa;">時間軸 (百萬年): <span id="mag-time-val">0</span> Ma</label>
                            <input type="range" id="mag-slider" min="0" max="100" value="0">
                            <canvas id="mag-canvas"></canvas>
                            <div class="mag-legend">
                                <div><span class="legend-box" style="background:#fff;"></span>正向極 (Normal)</div>
                                <div><span class="legend-box" style="background:#333;"></span>反向極 (Reverse)</div>
                            </div>
                        </div>`;
                }
                // --- 遊戲 2: 熱流模擬器 ---
                else if (item.type === 'game_heat') {
                    html += `
                        <div class="game-box">
                            <h2 style="color:var(--accent-cyan); text-align:center;"><i class="fas fa-fire"></i> ${item.heading}</h2>
                            <p style="color:#ccc; text-align:center; margin-bottom:15px;">${item.caption}</p>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                                <div>
                                    <label style="color:#aaa;">導熱係數 k: <span id="k-val">2.5</span></label>
                                    <input type="range" id="k-input" min="1" max="5" step="0.1" value="2.5">
                                    <br><br>
                                    <label style="color:#aaa;">地溫梯度: <span id="grad-val">30</span></label>
                                    <input type="range" id="grad-input" min="10" max="80" value="30">
                                </div>
                                <div style="text-align:center; background:rgba(0,0,0,0.3); padding:20px; border-radius:10px;">
                                    <div style="color:#aaa;">預測深部溫度</div>
                                    <div style="font-size:2.5rem; color:var(--accent-cyan); font-weight:bold;"><span id="temp-res">110</span>°C</div>
                                </div>
                            </div>
                        </div>`;
                }
            });
            wrapper.innerHTML = html;

            // 初始化遊戲
            setTimeout(() => {
                if(document.getElementById('mag-slider')) initMagneticGame();
                if(document.getElementById('k-input')) initHeatGame();
            }, 100);
        }

        // 遊戲 1 邏輯：磁條帶
        function initMagneticGame() {
            const slider = document.getElementById('mag-slider');
            const canvas = document.getElementById('mag-canvas');
            const ctx = canvas.getContext('2d');
            const timeVal = document.getElementById('mag-time-val');
            
            // 模擬磁極倒轉歷史 (0=Normal, 1=Reverse)
            const polarityHistory = [];
            for(let i=0; i<100; i++) polarityHistory.push(Math.random() > 0.5 ? 1 : 0);

            function draw() {
                const w = canvas.width = canvas.offsetWidth;
                const h = canvas.height;
                const time = parseInt(slider.value);
                timeVal.innerText = time;
                
                const centerX = w / 2;
                const spreadRate = 3; // 擴張速率
                const currentWidth = time * spreadRate;

                ctx.clearRect(0, 0, w, h);
                
                // 繪製洋脊中心
                ctx.fillStyle = 'red';
                ctx.fillRect(centerX - 1, 0, 2, h);

                // 往兩側繪製
                for(let t=0; t<time; t++) {
                    const color = polarityHistory[t] === 1 ? '#333' : '#fff'; // 黑=反, 白=正
                    const xOffset = (time - t) * spreadRate;
                    
                    ctx.fillStyle = color;
                    // 左側
                    ctx.fillRect(centerX - xOffset, 0, spreadRate, h);
                    // 右側 (對稱)
                    ctx.fillRect(centerX + xOffset - spreadRate, 0, spreadRate, h);
                }
            }
            slider.addEventListener('input', draw);
            draw();
        }

        // 遊戲 2 邏輯：熱流
        function initHeatGame() {
            const kIn = document.getElementById('k-input');
            const gIn = document.getElementById('grad-input');
            
            function update() {
                const k = parseFloat(kIn.value);
                const g = parseFloat(gIn.value);
                const depth = 3; // 固定深度 3km 簡化顯示
                
                document.getElementById('k-val').innerText = k;
                document.getElementById('grad-val').innerText = g;
                
                const temp = 20 + g * depth;
                document.getElementById('temp-res').innerText = temp.toFixed(1);
            }
            kIn.addEventListener('input', update);
            gIn.addEventListener('input', update);
        }
    </script>
</body>
</html>